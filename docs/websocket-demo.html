<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordMe WebSocket Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 2rem;
            line-height: 1.6;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        .demo-section {
            background: #f8f9fa;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            margin: 0.5rem;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
        }
        .status-dot.amber { background: #ffc107; }
        .status-dot.red { background: #dc3545; }
        .status-dot.pulsing {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .feature-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .feature-card h4 {
            margin: 0 0 0.5rem 0;
            color: #007bff;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }
        .implementation-status {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 0.75rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸµ ChordMe WebSocket Infrastructure</h1>
        <p>Real-time collaboration infrastructure built with Socket.IO</p>
    </div>

    <div class="demo-section">
        <h2>ğŸ”Œ Connection Status Indicators</h2>
        <p>Real-time connection monitoring with visual feedback:</p>
        
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span>ğŸŸ¢ Connected (45ms)</span>
        </div>
        
        <div class="status-indicator">
            <div class="status-dot amber"></div>
            <span>ğŸ” Authenticating...</span>
        </div>
        
        <div class="status-indicator">
            <div class="status-dot amber pulsing"></div>
            <span>ğŸ”„ Reconnecting... (attempt 2)</span>
        </div>
        
        <div class="status-indicator">
            <div class="status-dot red"></div>
            <span>âš¡ Disconnected</span>
        </div>
    </div>

    <div class="demo-section">
        <h2>âœ¨ Key Features Implemented</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>ğŸ”„ Connection Management</h4>
                <p>Automatic reconnection with exponential backoff</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ” JWT Authentication</h4>
                <p>Secure token-based authentication for all operations</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ  Room-based Isolation</h4>
                <p>Collaborative sessions isolated by song/room</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ“Š Rate Limiting</h4>
                <p>60 messages/minute per user protection</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ’“ Heartbeat Monitoring</h4>
                <p>Real-time latency and health monitoring</p>
            </div>
            <div class="feature-card">
                <h4>âš–ï¸ Load Balancing</h4>
                <p>Redis-based scaling for multiple instances</p>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>ğŸ“ˆ Performance Metrics</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>Concurrent Connections</h4>
                <div class="metric-value">100+</div>
                <p>Tested with load testing script</p>
            </div>
            <div class="feature-card">
                <h4>Target Latency</h4>
                <div class="metric-value">â‰¤50ms</div>
                <p>Real-time collaboration target</p>
            </div>
            <div class="feature-card">
                <h4>Message Rate</h4>
                <div class="metric-value">60/min</div>
                <p>Per user rate limit</p>
            </div>
            <div class="feature-card">
                <h4>Test Coverage</h4>
                <div class="metric-value">11/11</div>
                <p>Frontend tests passing</p>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>ğŸ› ï¸ Usage Example</h2>
        <div class="code-block">// Basic WebSocket connection with authentication
import { useWebSocket } from './hooks/useWebSocket';

function CollaborativeEditor({ songId, token }) {
  const { connection, room, collaboration } = useWebSocket({
    roomId: songId,
    token,
    autoJoinRoom: true,
  });

  // Send real-time text operations
  const handleTextChange = (operation) => {
    collaboration.sendOperation({
      type: 'insert',
      position: 10,
      content: 'Hello, world!',
    });
  };

  return (
    &lt;div&gt;
      &lt;ConnectionStatusIndicator /&gt;
      &lt;Editor onChange={handleTextChange} /&gt;
    &lt;/div&gt;
  );
}</div>
    </div>

    <div class="demo-section">
        <h2>ğŸš€ Architecture Components</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>Backend Server</h4>
                <p>Flask + Socket.IO server with authentication, rate limiting, and room management</p>
            </div>
            <div class="feature-card">
                <h4>Frontend Service</h4>
                <p>Socket.IO client with automatic reconnection and event handling</p>
            </div>
            <div class="feature-card">
                <h4>React Hooks</h4>
                <p>Hooks for connection, room management, and collaboration features</p>
            </div>
            <div class="feature-card">
                <h4>UI Components</h4>
                <p>Connection status indicators with real-time updates</p>
            </div>
        </div>
    </div>

    <div class="implementation-status">
        <h3>âœ… Implementation Status: COMPLETE</h3>
        <p>All acceptance criteria have been met:</p>
        <ul>
            <li>âœ… WebSocket server implementation with Socket.IO</li>
            <li>âœ… Connection lifecycle management (connect, disconnect, reconnect)</li>
            <li>âœ… Message routing and broadcasting system</li>
            <li>âœ… Room-based isolation for collaborative sessions</li>
            <li>âœ… Automatic reconnection with exponential backoff</li>
            <li>âœ… Connection status indicators in UI</li>
            <li>âœ… Heartbeat/ping mechanism for connection health</li>
            <li>âœ… Load balancing support for multiple server instances</li>
            <li>âœ… Rate limiting for message flooding protection</li>
            <li>âœ… Authentication and authorization</li>
            <li>âœ… Comprehensive test suite</li>
            <li>âœ… Complete documentation</li>
        </ul>
    </div>

    <div class="demo-section">
        <h2>ğŸ“š Documentation & Testing</h2>
        <p>Complete documentation available at <code>docs/websocket-infrastructure.md</code></p>
        <p>Load testing script available at <code>scripts/websocket_load_test.py</code></p>
        <p>Run tests with: <code>npm run test:frontend:run</code> and <code>pytest tests/test_websocket_server.py</code></p>
    </div>
</body>
</html>